<html>
<head>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://js.balancedpayments.com/v1/balanced.js"></script>
<script>
$(document).ready(function () {
    ////
    // Initalize balanced.js
    //
    // server: The backend Balanced server to tokenize with
    // revision: The specific revision of the Balanced API to tokenize with
    ////
    
    // For example purposes, create a bin at http://requestb.in/
    // Make sure it doesn't end in ?inspect and set it as responseTarget.
    // e.g. var responseTarget = http://requestb.in/nyqkn8ny
    var responseTarget = 'http://requestb.in/1gonvkk1';  
    var marketplaceUri = '/v1/marketplaces/TEST-MP7elgEfkSDuYgKbJGJNR2Ny';
   
   //alert("Document Ready");
   
    balanced.init(marketplaceUri);
	
	//jQuery.post(responseTarget, 'test');
    
    ////
    // Click event for tokenize credit card
    ////
    $('#cc-submit').click(function (e) {
	
		//alert("submit clicked");
		
        e.preventDefault();

        $('#response').hide();

        var payload = {
            name: $('#cc-name').val(),
            card_number: $('#cc-number').val(),
            expiration_month: $('#cc-ex-month').val(),
            expiration_year: $('#cc-ex-year').val(),
            security_code: $('#ex-csc').val()
        };
        
		//alert.("payload name = "+payload.name);
		alert(JSON.stringify(payload, false, '\t'));
		
        // Tokenize credit card
        balanced.card.create(payload, function (response) {
            // Successful tokenization
			alert("tokenize\r\n"+"status="+response.status+"\r\nuri="+response.url+"\r\n response: "+JSON.stringify(response, false, 4));
			
            if(response.status === 201 && response.data.uri) {
			alert("tokenize successful");
                // Send to your backend
                jQuery.post(responseTarget, {
                    uri: response.data.uri, test1: "test2"
                }, function(r) {
                    // Check your backend response
                    if (r.status === 201) {
                        // Your successful logic here from backend
                    } else {
                        // Your failure logic here from backend
                    }
                });
            } else {
                // Failed to tokenize, your error logic here
            }
            
            // Debuging, just displays the tokenization result in a pretty div
            $('#response .panel-body pre').html(JSON.stringify(response, false, 4));
            $('#response').slideDown(300);
        });
    });
    
    
    ////
    // Simply populates credit card and bank account fields with test data
    ////
    $('#populate').click(function () {
        $(this).attr("disabled", true);

        $('#cc-name').val('John Doe');
        $('#cc-number').val('4111111111111111');
        $('#cc-ex-month').val('12');
        $('#cc-ex-year').val('2020');
        $('#ex-csc').val('123');
        $('#ba-name').val('John Doe');
        $('#ba-number').val('9900000000');
        $('#ba-routing').val('321174851');
    });
});
</script>
</head>
<body>
                        <form role="form" class="form-horizontal">                            
                            <div class="form-group">
                                <label class="col-lg-5 control-label">Card Number</label>
                                <div class="col-lg-5">
                                    <input type="text" id="cc-number" class="form-control" autocomplete="off" placeholder="4111111111111111" maxlength="16" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-5 control-label">Expiration</label>
                                <div class="col-lg-2">
                                    <input type="text" id="cc-ex-month" class="form-control" autocomplete="off" placeholder="01" maxlength="2" />
                                </div>
                                <div class="col-lg-2">
                                    <input type="text" id="cc-ex-year" class="form-control" autocomplete="off" placeholder="2013" maxlength="4" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-5 control-label">Security Code (CSC)</label>
                                <div class="col-lg-2">
                                    <input type="text" id="ex-csc" class="form-control" autocomplete="off" placeholder="453" maxlength="4" />
                                </div>
                            </div>
                            <a id="cc-submit" class="btn btn-large btn-primary pull-right" href="#">Tokenize</a>
							<a id="populate" class="btn btn-large btn-primary pull-right" href="#">Populate</a>
                       </form>
</body>
</html>